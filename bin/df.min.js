var __reflect=this&&this.__reflect||function(p,c,t){p.__class__=c,t?t.push(c):t=[c],p.__types__=p.__types__?t.concat(p.__types__):t};var df;(function(df){class TestComponent{constructor(){console.log("TestComponent create")}}df.TestComponent=TestComponent;__reflect(TestComponent.prototype,"df.TestComponent")})(df||(df={}));var df;(function(df){class BubbleAlgo{constructor(){this.startX=50;this.startY=50;this.gapX=3;this.gapY=2;this.row=8;this.col=10;this.bubbles=[];this._radius=25;this._diameter=this._radius*2;this._addLineIndex=-1;this._unites=[];this._scans=[]}initConfig(startX,startY,gapX,gapY,row,col){this.startX=startX;this.startY=startY;this.gapX=gapX;this.gapY=gapY;this.row=row;this.col=col}initBubbles(r,type,Class){this._radius=r;this._type=type;this._class=Class;this._addLineIndex=-1;this.bubbles.length=0;let sx;this._startY=this._radius+this.startY;for(let i=0;i<this.row;i++){for(let j=0;j<this.col;j++){if(i%2==0){sx=this._radius+this.startX}else{sx=this._diameter+this.startX}let bubble=this.createBubble();bubble.row=i;bubble.x=sx+j*(this._diameter+this.gapX);bubble.y=this._startY+i*(this._diameter+this.gapY);this.bubbles.push(bubble)}}return this.bubbles}createBubble(){let bubble=new this._class;bubble.type=df.MathUtil.randomInt(0,this._type-1);return bubble}addBubbleLine(){for(let i=0;i<this.bubbles.length;i++){this.bubbles[i].y+=this._diameter+this.gapY}let line=[];let sx;for(let j=0;j<this.col;j++){if(this._addLineIndex%2==0){sx=this._radius+this.startX}else{sx=this._diameter+this.startX}let bubble=this.createBubble();bubble.row=this._addLineIndex;bubble.x=sx+j*(this._diameter+this.gapX);bubble.y=this._startY;this.bubbles.push(bubble);line.push(bubble)}this._addLineIndex--;return line}linkBubble(linked,link){let gpx=this.gapX;let gpy=this.gapY;let r=this._radius;let d=this._diameter;let roundPoints=[{x:linked.x+d+gpx,y:linked.y,row:linked.row},{x:linked.x-(d+gpx),y:linked.y,row:linked.row},{x:linked.row%2==0?linked.x-(r+gpx):linked.x-r,y:linked.y-(d+gpy),row:linked.row-1},{x:linked.row%2==0?linked.x-(r+gpx):linked.x-r,y:linked.y+d+gpy,row:linked.row+1},{x:linked.row%2==0?linked.x+r:linked.x+r+gpx,y:linked.y-(d+gpy),row:linked.row-1},{x:linked.row%2==0?linked.x+r:linked.x+r+gpx,y:linked.y+d+gpy,row:linked.row+1}];for(let i=0;i<roundPoints.length;i++){let p=roundPoints[i];let dis=df.MathUtil.dis(p,link);p.dis=dis}df.ArrayUtil.sortAscBy("dis",roundPoints);link.x=roundPoints[0].x;link.y=roundPoints[0].y;link.row=roundPoints[0].row;this.bubbles.push(link)}getFallBubbles(){let fallBubbles=[];for(let i=0;i<this.bubbles.length;i++){if(this.bubbles[i].visible){let unites=this.getUniteBubbles(this.bubbles[i],false);let root=false;for(let j=0;j<unites.length;j++){if(unites[j].y==this._startY){root=true;break}}if(!root){for(let j=0;j<unites.length;j++){if(fallBubbles.indexOf(unites[j])==-1){fallBubbles.push(unites[j])}}}}}return fallBubbles}getUniteBubbles(bubble,color){this._unites.length=0;this._scans.length=0;this.scanUniteBubbles(bubble,color);return this._unites}scanUniteBubbles(bubble,color){if(bubble.visible&&this._scans.indexOf(bubble)==-1){this._scans.push(bubble);if(this._unites.indexOf(bubble)==-1){this._unites.push(bubble);let roundBubbles=this.selectRoundBubbles(bubble);for(let i=0;i<roundBubbles.length;i++){if(color){if(roundBubbles[i].type==bubble.type){this.scanUniteBubbles(roundBubbles[i],true)}}else{this.scanUniteBubbles(roundBubbles[i],false)}}}}}selectRoundBubbles(bubble){let gpx=this.gapX;let gpy=this.gapY;let r=this._radius;let d=this._diameter;let roundPoints=[{x:bubble.x+d+gpx,y:bubble.y},{x:bubble.x-(d+gpx),y:bubble.y},{x:bubble.row%2==0?bubble.x-(r+gpx):bubble.x-r,y:bubble.y-(d+gpy)},{x:bubble.row%2==0?bubble.x-(r+gpx):bubble.x-r,y:bubble.y+d+gpy},{x:bubble.row%2==0?bubble.x+r:bubble.x+r+gpx,y:bubble.y-(d+gpy)},{x:bubble.row%2==0?bubble.x+r:bubble.x+r+gpx,y:bubble.y+d+gpy}];let roundBubbles=[];for(let i=0;i<this.bubbles.length;i++){let pop=this.bubbles[i];for(let j=0;j<roundPoints.length;j++){let round=roundPoints[j];if(pop.x==round.x&&pop.y==round.y){roundBubbles.push(pop)}}}return roundBubbles}}df.BubbleAlgo=BubbleAlgo;__reflect(BubbleAlgo.prototype,"df.BubbleAlgo")})(df||(df={}));var df;(function(df){class FallWrapper{constructor(){this._startAngel=Math.random()*360}init(entity,vy,angelStep){this._entity=entity;this._vy=vy;this._angelStep=angelStep}move(){this._entity.y+=this._vy;this._startAngel+=this._angelStep;this._entity.x+=Math.sin(this._startAngel)}get x(){return this._entity.x}set x(v){this._entity.x=v}set y(v){this._entity.y=v}get y(){return this._entity.y}get width(){return this._entity.width}get height(){return this._entity.height}get visible(){return this._entity.visible}set visible(v){this._entity.visible=v}get entity(){return this._entity}}df.FallWrapper=FallWrapper;__reflect(FallWrapper.prototype,"df.FallWrapper")})(df||(df={}));var df;(function(df){class GameSound{constructor(){this._audioCache={};this._bgmCache={}}static get instance(){if(!this._instance){this._instance=new GameSound}return this._instance}playAudio(url,volume=1){let soundData=this._audioCache[url];if(soundData){if(this.audioOpen){soundData.sound.play(0,1).volume=volume}}else{this.loadAudio(url,volume)}}loadAudio(url,volume=1){let sound=new egret.Sound;sound.type=egret.Sound.EFFECT;sound.addEventListener(egret.Event.COMPLETE,event=>{if(this.audioOpen){sound.play(0,1).volume=volume}this._audioCache[url]={sound:sound}},this);sound.addEventListener(egret.IOErrorEvent.IO_ERROR,event=>{console.log(`${url} load error!`)},this);sound.load(url)}playBgm(url,volume=1){let soundData=this._bgmCache[url];if(soundData){if(this.bgmOpen){this._curBgm.stop();this._curBgm=soundData.sound.play(0);this._curBgm.volume=volume;this._curBgmData=soundData}}else{this.loadBgm(url,volume)}}loadBgm(url,volume=1){let sound=new egret.Sound;sound.type=egret.Sound.MUSIC;sound.addEventListener(egret.Event.COMPLETE,event=>{if(this.bgmOpen){this._curBgm=sound.play(0);this._curBgm.volume=volume;this._curBgmData=this._bgmCache[url]}this._bgmCache[url]={sound:sound}},this);sound.addEventListener(egret.IOErrorEvent.IO_ERROR,event=>{console.log(`${url} load error!`)},this);sound.load(url)}pauseBgm(){if(this._curBgm){this._bgmPosition=this._curBgm.position;this._curBgm.stop()}}resumeBgm(){if(this.bgmOpen&&this._curBgmData){this._curBgm=this._curBgmData.sound.play(this._bgmPosition)}}}df.GameSound=GameSound;__reflect(GameSound.prototype,"df.GameSound")})(df||(df={}));var df;(function(df){class H5Sound{constructor(){}static get instance(){if(!this._instance){this._instance=new H5Sound}return this._instance}playBgm(url,volume=1){if(!this._bgm){this._bgm=new Audio;this._bgm.loop=true;this._bgm.setAttribute("webkit-playsinline","true");this._bgm.setAttribute("playsinline","true")}this._bgm.src=url;this._bgm.volume=volume;if(!this.bgmOpen){return}this._bgm.play()}pauseBgm(){if(this._bgm){this._bgm.pause()}}resumeBgm(){if(this._bgm&&this.bgmOpen){this._bgm.play()}}playAudio(url,volume=1){let audio=new Audio;audio.src=url;audio.volume=volume;audio.setAttribute("webkit-playsinline","true");audio.setAttribute("playsinline","true");if(this.audioOpen){audio.play()}}}df.H5Sound=H5Sound;__reflect(H5Sound.prototype,"df.H5Sound")})(df||(df={}));var df;(function(df){class LoopY{constructor(){this._heads=[];this._tails=[]}init(arr,limitY){this._arr=arr;this._limitY=limitY;this._totalH=0;for(let i=0;i<this._arr.length;i++){let item=this._arr[i];this._totalH+=item.height}}step(v){let realY=v%this._totalH;for(let i=0;i<this._arr.length;i++){let item=this._arr[i];item.y+=realY}if(realY>0){this._heads.length=0;for(let i=0;i<this._arr.length;i++){let item=this._arr[i];if(item.y>this._limitY){this._heads.push(item)}}let head=this._arr[0];let headY=head.y;for(let i=this._heads.length-1;i>-1;i--){let item=this._heads[i];item.y=headY-item.height;headY=item.y}df.ArrayUtil.cull(this._arr,this._heads);this._arr=this._heads.concat(this._arr)}else{this._tails.length=0;for(let i=0;i<this._arr.length;i++){let item=this._arr[i];if(item.y+item.height<0){this._tails.push(item)}}let tail=this._arr[this._arr.length-1];let tailY=tail.y+tail.height;for(let i=0;i<this._tails.length;i++){let item=this._tails[i];item.y=tailY;tailY+=item.y+item.height}df.ArrayUtil.cull(this._arr,this._tails);this._arr=this._arr.concat(this._tails)}}}df.LoopY=LoopY;__reflect(LoopY.prototype,"df.LoopY")})(df||(df={}));var df;(function(df){class Pool{constructor(){this._pool={}}static get instance(){if(!this._instance){this._instance=new Pool}return this._instance}getFrom(cls){if(this._pool[cls.prototype["__class__"]]){return this._pool[cls.prototype["__class__"]].pop()}else{return new cls}}backTo(instance){if(!this._pool[instance.__proto__["__class__"]]){this._pool[instance.__proto__["__class__"]]=[]}this._pool[instance.__proto__["__class__"]].push(instance)}clear(){this._pool={}}debug(){console.log(this._pool)}}df.Pool=Pool;__reflect(Pool.prototype,"df.Pool")})(df||(df={}));var df;(function(df){class Quadtree{constructor(){this._objects=[];this._nodes=[];this.root=true}init(bounds,max_objects,max_levels,level){this._max_objects=max_objects||10;this._max_levels=max_levels||4;this._level=level||0;this._bounds=bounds;this._objects.length=0;this._nodes.length=0}split(){var nextLevel=this._level+1,subWidth=this._bounds.width/2,subHeight=this._bounds.height/2,x=this._bounds.x,y=this._bounds.y;this._nodes[0]=df.Pool.instance.getFrom(Quadtree);this._nodes[0].root=false;this._nodes[0].init({x:x+subWidth,y:y,width:subWidth,height:subHeight},this._max_objects,this._max_levels,nextLevel);this._nodes[1]=df.Pool.instance.getFrom(Quadtree);this._nodes[1].root=false;this._nodes[1].init({x:x,y:y,width:subWidth,height:subHeight},this._max_objects,this._max_levels,nextLevel);this._nodes[2]=df.Pool.instance.getFrom(Quadtree);this._nodes[2].root=false;this._nodes[2].init({x:x,y:y+subHeight,width:subWidth,height:subHeight},this._max_objects,this._max_levels,nextLevel);this._nodes[3]=df.Pool.instance.getFrom(Quadtree);this._nodes[3].root=false;this._nodes[3].init({x:x+subWidth,y:y+subHeight,width:subWidth,height:subHeight},this._max_objects,this._max_levels,nextLevel)}getIndex(pRect){var indexes=[],verticalMidpoint=this._bounds.x+this._bounds.width/2,horizontalMidpoint=this._bounds.y+this._bounds.height/2;var startIsNorth=pRect.y<horizontalMidpoint,startIsWest=pRect.x<verticalMidpoint,endIsEast=pRect.x+pRect.width>verticalMidpoint,endIsSouth=pRect.y+pRect.height>horizontalMidpoint;if(startIsNorth&&endIsEast){indexes.push(0)}if(startIsWest&&startIsNorth){indexes.push(1)}if(startIsWest&&endIsSouth){indexes.push(2)}if(endIsEast&&endIsSouth){indexes.push(3)}return indexes}insert(pRect){var i=0,indexes;if(this._nodes.length){indexes=this.getIndex(pRect);for(i=0;i<indexes.length;i++){this._nodes[indexes[i]].insert(pRect)}return}this._objects.push(pRect);if(this._objects.length>this._max_objects&&this._level<this._max_levels){if(!this._nodes.length){this.split()}for(i=0;i<this._objects.length;i++){indexes=this.getIndex(this._objects[i]);for(var k=0;k<indexes.length;k++){this._nodes[indexes[k]].insert(this._objects[i])}}this._objects=[]}}retrieve(pRect){var indexes=this.getIndex(pRect),returnObjects=this._objects;if(this._nodes.length){for(var i=0;i<indexes.length;i++){returnObjects=returnObjects.concat(this._nodes[indexes[i]].retrieve(pRect))}}returnObjects=returnObjects.filter(function(item,index){return returnObjects.indexOf(item)>=index});return returnObjects}clear(){this._objects.length=0;for(var i=0;i<this._nodes.length;i++){if(this._nodes.length){this._nodes[i].clear()}}this._nodes.length=0;if(!this.root){df.Pool.instance.backTo(this)}}}df.Quadtree=Quadtree;__reflect(Quadtree.prototype,"df.Quadtree")})(df||(df={}));var df;(function(df){class CameraY{constructor(){}get roleY(){let disY=this.roleRealY-this.cameraActY;if(disY>=0){disY=0}return this.roleRealY-disY}get nowBgY(){let disY=this.roleRealY-this.cameraActY;if(disY<0){return this.originBgY-disY}return this.originBgY}}df.CameraY=CameraY;__reflect(CameraY.prototype,"df.CameraY")})(df||(df={}));var df;(function(df){class TestUI extends df.TestComponent{constructor(){super();console.log("TestUI create")}}df.TestUI=TestUI;__reflect(TestUI.prototype,"df.TestUI")})(df||(df={}));var df;(function(df){class ACAlgo{constructor(){this._animalNames=["鼠","猫","狐","狼","豹","虎","狮","象"];this._winSteps=[];this._failSteps=[];this._tieSteps=[]}initGrids(){if(!this.grids){this.grids=[]}else{this.grids.length=0}for(let i=0;i<16;i++){let grid=new df.ACGrid;grid.num=i%8;grid.isEmpty=false;grid.isAsk=true;grid.isMe=i>7?false:true;this.grids.push(grid)}df.ArrayUtil.random(this.grids);for(let i=0;i<this.grids.length;i++){let grid=this.grids[i];grid.gridX=i%4;grid.gridY=Math.floor(i/4)}}print(){let line=0;let str="";for(let i=0;i<this.grids.length;i++){let grid=this.grids[i];if(line!=grid.gridY){line=grid.gridY;str+="\n"}if(grid.isEmpty){str+="_ "}else if(grid.isAsk){str+="? "}else if(grid.isMe){str+=`${this.getAnimalName(grid.num)} `}else{str+=`${grid.num} `}}console.log(str);console.log("*************************************")}getAnimalName(num){if(num==-1){return"无"}return this._animalNames[num]}auto(camp){this._camp=camp;this._winSteps=[];this._failSteps=[];this._tieSteps=[];let win=[];let fail=[];let tie=[];for(let i=0;i<this.grids.length;i++){let enemy=this.grids[i];if(!enemy.isMe&&!enemy.isEmpty&&!enemy.isAsk){let roundGrids=this.selectRoundGrid(enemy);for(let j=0;j<roundGrids.length;j++){let me=roundGrids[j];if(me.isMe&&!me.isEmpty&&!me.isAsk){if(this._camp==1){this.winFailArr(enemy,me,win,fail,tie)}else{this.winFailArr(me,enemy,win,fail,tie)}}}}}this._winSteps.sort((a,b)=>{if(a.me.num>b.me.num){return-1}else if(a.me.num<b.me.num){return 1}else{return 0}});this._failSteps.sort((a,b)=>{if(a.enemy.num>b.enemy.num){return-1}else if(a.enemy.num<b.enemy.num){return 1}else{return 0}});this._tieSteps.sort((a,b)=>{if(a.enemy.num>b.enemy.num){return-1}else if(a.enemy.num<b.enemy.num){return 1}else{return 0}});this._winMax=df.ArrayUtil.maxNum(win);this._failMax=df.ArrayUtil.maxNum(fail);this._tieMax=df.ArrayUtil.maxNum(tie);let opt;if(this._winMax>this._failMax){opt=ACCampOpt.EAT}else if(this._winMax<this._failMax){opt=ACCampOpt.RUN;if(this._winSteps[0]&&this._winSteps[0].enemy.num==this._failMax){opt=ACCampOpt.EAT}}else if(this._winMax==this._failMax&&this._winMax!=-1){opt=ACCampOpt.EAT}else{if(this._tieMax!=-1){opt=ACCampOpt.TIE}else{opt=ACCampOpt.FLOP}}if(!this.isFloped()){opt=ACCampOpt.FLOP}console.log(`胜_${this.getAnimalName(this._winMax)}`,`负_${this.getAnimalName(this._failMax)}`,`平_${this.getAnimalName(this._tieMax)}`);this.action(opt)}winFailArr(enemy,me,win,fail,tie){let vsr=this.checkVSR(enemy,me);switch(vsr){case ACChessVS.WIN:if(!this.isInQueue(enemy,me,this._winSteps)){this._winSteps.push({enemy:enemy,me:me})}if(!df.ArrayUtil.includes(win,me.num)){win.push(me.num)}break;case ACChessVS.FAIL:if(!this.isInQueue(enemy,me,this._failSteps)){this._failSteps.push({enemy:enemy,me:me})}if(!df.ArrayUtil.includes(fail,enemy.num)){fail.push(enemy.num)}break;case ACChessVS.TIE:if(!this.isInQueue(enemy,me,this._tieSteps)){this._tieSteps.push({enemy:enemy,me:me})}if(!df.ArrayUtil.includes(tie,enemy.num)){tie.push(enemy.num)}break;default:break}}checkVSR(me,enemy){let vsr;if(me.num>enemy.num){vsr=ACChessVS.WIN;if(me.num==7&&enemy.num==0){vsr=ACChessVS.FAIL}}else if(me.num==enemy.num){vsr=ACChessVS.TIE}else if(me.num<enemy.num){vsr=ACChessVS.FAIL;if(me.num==0&&enemy.num==7){vsr=ACChessVS.WIN}}return vsr}isInQueue(enemy,me,arr){let r=false;for(let i=0;i<arr.length;i++){if(arr[i].enemy.gridX==enemy.gridX&&arr[i].enemy.gridY==enemy.gridY&&arr[i].me.gridX==me.gridX&&arr[i].me.gridY==me.gridY){r=true;break}}return r}isFloped(){let r=false;for(let i=0;i<this.grids.length;i++){if(!this.grids[i].isAsk){r=true;break}}return r}hasAsk(){let r=false;for(let i=0;i<this.grids.length;i++){if(this.grids[i].isAsk){r=true;break}}return r}action(opt){switch(opt){case ACCampOpt.EAT:console.log(`阵营_${this._camp} 吃`);let win=this._winSteps[0];let enemy=win.enemy;let me=win.me;df.EventBus.instance.emit(ACAlgo.EATING,{eating:enemy,eated:me});break;case ACCampOpt.RUN:console.log(`阵营_${this._camp} 跑`);this.chessRun();break;case ACCampOpt.TIE:console.log(`阵营_${this._camp} 拼`);if(this._tieMax!=-1){let tie=this._tieSteps[0];df.EventBus.instance.emit(ACAlgo.EATING,{eating:tie.enemy,eated:tie.me})}else{this.action(ACCampOpt.FLOP)}break;case ACCampOpt.FLOP:console.log(`阵营_${this._camp} 翻`);let asks=[];for(let i=0;i<this.grids.length;i++){if(this.grids[i].isAsk){asks.push(this.grids[i])}}df.ArrayUtil.random(asks);if(asks.length>0){df.EventBus.instance.emit(ACAlgo.FLOP,{flop:asks[0]})}else{this.action(ACCampOpt.MOVE)}break;default:console.log(`阵营_${this._camp} 瞎`);this.moveRandom();break}}eat(event){let eating=event.data.eating;let eated=event.data.eated;console.log(`阵营_${this._camp}${this.getAnimalName(eating.num)}去吃${this.getAnimalName(eated.num)}`);let vsr=this.checkVSR(eating,eated);switch(vsr){case ACChessVS.WIN:eated.num=eating.num;eated.isMe=eating.isMe;eating.isEmpty=true;break;case ACChessVS.FAIL:eating.isEmpty=true;break;case ACChessVS.TIE:eated.isEmpty=eating.isEmpty=true;break}this.print();this.checkRoundVS()}chessRun(){let maySafe=[];for(let i=0;i<this._failSteps.length;i++){let enemy;enemy=this._failSteps[i].enemy;let gridDatas=this.selectRoundGrid(enemy);for(let j=0;j<gridDatas.length;j++){if(gridDatas[j].isEmpty){gridDatas[j].num=enemy.num;gridDatas[j].isEmpty=false;enemy.isEmpty=true;if(!this.dangerous(gridDatas[j])){maySafe.push({enemy:enemy,grid:gridDatas[j]})}gridDatas[j].isEmpty=true;enemy.isEmpty=false}}}maySafe.sort((a,b)=>{if(a.enemy.num>b.enemy.num){return-1}else if(a.enemy.num<b.enemy.num){return 1}else{return 0}});let valueSafe;this._valueRun=false;if(maySafe.length>0){for(let i=0;i<maySafe.length;i++){if(this._winMax<maySafe[i].enemy.num){this._valueRun=true;valueSafe=maySafe[i];break}}}this._canRun=false;if(maySafe.length>0&&!this._valueRun){this._canRun=true}if(this._valueRun){df.EventBus.instance.emit(ACAlgo.MOVE,{src:valueSafe.enemy,target:valueSafe.grid})}else if(this._canRun){df.EventBus.instance.emit(ACAlgo.MOVE,{src:maySafe[0].enemy,target:maySafe[0].grid})}else{this.action(ACCampOpt.TIE)}}selectRoundGrid(chess){let r=[];for(let i=0;i<this.grids.length;i++){let data=this.grids[i];if(chess.gridX==data.gridX&&chess.gridY==data.gridY+1){data.dir=ACGridWay.UP;r.push(data)}if(chess.gridX==data.gridX&&chess.gridY==data.gridY-1){data.dir=ACGridWay.DOWN;r.push(data)}if(chess.gridX==data.gridX+1&&chess.gridY==data.gridY){data.dir=ACGridWay.LEFT;r.push(data)}if(chess.gridX==data.gridX-1&&chess.gridY==data.gridY){data.dir=ACGridWay.RIGHT;r.push(data)}}return r}dangerous(me){let r=false;let gridDatas=this.selectRoundGrid(me);for(let i=0;i<gridDatas.length;i++){let enemy=gridDatas[i];if(!enemy.isEmpty&&!enemy.isAsk&&enemy.isMe!=me.isMe){let vsr=this.checkVSR(me,enemy);if(vsr==ACChessVS.FAIL){r=true;break}}}return r}move(event){let src=event.data.src;let target=event.data.target;console.log(`阵营_${this._camp} ${this.getAnimalName(src.num)}移动${target.gridX}_${target.gridY}`);src.isEmpty=true;target.isEmpty=false;target.isMe=src.isMe;target.num=src.num;this.print()}flop(event){let flop=event.data.flop;console.log(`${flop.gridX}_${flop.gridY} 翻到阵营_${flop.isMe?0:1} ${this.getAnimalName(flop.num)}`);flop.isAsk=false;this.print();this.checkRoundVS()}moveRandom(){let maySafe=[];let mayDangerous=[];for(let i=0;i<this.grids.length;i++){let enemy=this.grids[i];let condition;if(this._camp==1){condition=!enemy.isMe}else{condition=enemy.isMe}if(condition&&!enemy.isAsk&&!enemy.isEmpty){let gridDatas=this.selectRoundGrid(enemy);for(let j=0;j<gridDatas.length;j++){if(gridDatas[j].isEmpty){gridDatas[j].num=enemy.num;gridDatas[j].isEmpty=false;enemy.isEmpty=true;if(!this.dangerous(enemy)){maySafe.push({enemy:enemy,grid:gridDatas[j]})}gridDatas[j].isEmpty=true;enemy.isEmpty=false}}}}if(maySafe.length>0){let sr=Math.floor(maySafe.length*Math.random());df.EventBus.instance.emit(ACAlgo.MOVE,{src:maySafe[sr].enemy,target:maySafe[sr].grid})}else if(mayDangerous.length>0){let dr=Math.floor(mayDangerous.length*Math.random());df.EventBus.instance.emit(ACAlgo.MOVE,{src:mayDangerous[dr].enemy,target:mayDangerous[dr].grid})}else{console.log("僵局！！！")}}checkRoundVS(){if(this.hasAsk()){return}let enemy=[];let me=[];for(let i=0;i<this.grids.length;i++){let chess=this.grids[i];if(!chess.isEmpty&&!chess.isAsk){if(chess.isMe){me.push(chess)}else{enemy.push(chess)}}}let ac;if(enemy.length==1&&me.length!=0){let w=true;let flag=true;for(let i=0;i<me.length;i++){let vsr=this.checkVSR(enemy[0],me[i]);if(vsr!=ACChessVS.WIN&&flag){flag=false;w=false}if(vsr==ACChessVS.FAIL){ac=ACRoundVS.WIN;break}else if(vsr==ACChessVS.TIE){if(me.length==1){ac=ACRoundVS.TIE;break}else{ac=ACRoundVS.WIN;break}}}if(w){ac=ACRoundVS.FAIL}if(ac==undefined){ac=ACRoundVS.FAIL}}else if(me.length==1&&enemy.length!=0){let w=true;let flag=true;for(let i=0;i<enemy.length;i++){let vsr=this.checkVSR(me[0],enemy[i]);if(vsr!=ACChessVS.WIN&&flag){flag=false;w=false}if(vsr==ACChessVS.FAIL){ac=ACRoundVS.FAIL;break}else if(vsr==ACChessVS.TIE){if(enemy.length==1){ac=ACRoundVS.TIE;break}else{ac=ACRoundVS.FAIL;break}}}if(w){ac=ACRoundVS.WIN}if(ac==undefined){ac=ACRoundVS.FAIL}}else if(me.length==0){ac=ACRoundVS.FAIL}else if(enemy.length==0){ac=ACRoundVS.WIN}switch(ac){case ACRoundVS.WIN:df.EventBus.instance.emit(ACAlgo.WIN,{win:0});break;case ACRoundVS.FAIL:df.EventBus.instance.emit(ACAlgo.WIN,{win:1});break;case ACRoundVS.TIE:df.EventBus.instance.emit(ACAlgo.WIN,{win:-1});break}}win(event){let win=event.data.win;if(win==-1){console.log("---平局---")}else{console.log(`阵营_${win}_获胜`)}}getMoveDirs(chess){let r=this.selectRoundGrid(chess);let canMove=[];for(let i=0;i<r.length;i++){if(r[i].isEmpty||!r[i].isAsk&&r[i].isMe!=chess.isMe){let dir=r[i].dir;canMove.push(dir)}}return canMove}flopXy(gridX,gridY){let grid=this.getGrid(gridX,gridY);this.flop({data:{flop:grid}})}eatXy(eating,eated){let eatingGrid=this.getGrid(eating.gridX,eating.gridY);let eatedGrid=this.getGrid(eated.gridX,eated.gridY);this.eat({data:{eating:eatingGrid,eated:eatedGrid}})}moveXy(src,target){let srcGrid=this.getGrid(src.gridX,src.gridY);let targetGrid=this.getGrid(target.gridX,target.gridY);this.move({data:{src:srcGrid,target:targetGrid}})}getGrid(gridX,gridY){for(let i=0;i<this.grids.length;i++){let grid=this.grids[i];if(grid.gridX==gridX&&grid.gridY==gridY){return grid}}return}}ACAlgo.EATING="acalgo_eating";ACAlgo.MOVE="acalgo_move";ACAlgo.FLOP="acalgo_flop";ACAlgo.WIN="acalgo_win";df.ACAlgo=ACAlgo;__reflect(ACAlgo.prototype,"df.ACAlgo");let ACGridWay;(function(ACGridWay){ACGridWay[ACGridWay["UP"]=0]="UP";ACGridWay[ACGridWay["DOWN"]=1]="DOWN";ACGridWay[ACGridWay["LEFT"]=2]="LEFT";ACGridWay[ACGridWay["RIGHT"]=3]="RIGHT"})(ACGridWay=df.ACGridWay||(df.ACGridWay={}));let ACCampOpt;(function(ACCampOpt){ACCampOpt[ACCampOpt["EAT"]=0]="EAT";ACCampOpt[ACCampOpt["RUN"]=1]="RUN";ACCampOpt[ACCampOpt["TIE"]=2]="TIE";ACCampOpt[ACCampOpt["MOVE"]=3]="MOVE";ACCampOpt[ACCampOpt["FLOP"]=4]="FLOP"})(ACCampOpt||(ACCampOpt={}));let ACChessVS;(function(ACChessVS){ACChessVS[ACChessVS["WIN"]=0]="WIN";ACChessVS[ACChessVS["FAIL"]=1]="FAIL";ACChessVS[ACChessVS["TIE"]=2]="TIE"})(ACChessVS||(ACChessVS={}));let ACRoundVS;(function(ACRoundVS){ACRoundVS[ACRoundVS["WIN"]=0]="WIN";ACRoundVS[ACRoundVS["FAIL"]=1]="FAIL";ACRoundVS[ACRoundVS["TIE"]=2]="TIE"})(ACRoundVS||(ACRoundVS={}))})(df||(df={}));var df;(function(df){class ACGrid{constructor(){}}df.ACGrid=ACGrid;__reflect(ACGrid.prototype,"df.ACGrid")})(df||(df={}));var df;(function(df){class EventBus{constructor(){this._listeners={}}static get instance(){if(!this._instance){this._instance=new EventBus}return this._instance}addEventListener(type,callback,scope){var args=[];var numOfArgs=arguments.length;for(var i=0;i<numOfArgs;i++){args.push(arguments[i])}args=args.length>3?args.splice(3,args.length-1):[];if(typeof this._listeners[type]!="undefined"){this._listeners[type].push({scope:scope,callback:callback,args:args})}else{this._listeners[type]=[{scope:scope,callback:callback,args:args}]}}removeEventListener(type,callback,scope){if(typeof this._listeners[type]!="undefined"){var numOfCallbacks=this._listeners[type].length;var newArray=[];for(var i=0;i<numOfCallbacks;i++){var listener=this._listeners[type][i];if(listener.scope==scope&&listener.callback==callback){}else{newArray.push(listener)}}this._listeners[type]=newArray}}emit(type,data){var event={type:type,data:data};var args=[];var numOfArgs=arguments.length;for(var i=0;i<numOfArgs;i++){args.push(arguments[i])}args=args.length>2?args.splice(2,args.length-1):[];args=[event].concat(args);if(typeof this._listeners[type]!="undefined"){var listeners=this._listeners[type].slice();var numOfCallbacks=listeners.length;for(var i=0;i<numOfCallbacks;i++){var listener=listeners[i];if(listener&&listener.callback){var concatArgs=args.concat(listener.args);listener.callback.apply(listener.scope,concatArgs)}}}}}df.EventBus=EventBus;__reflect(EventBus.prototype,"df.EventBus")})(df||(df={}));var df;(function(df){class BubbleRay{constructor(){this.rect={x:0,y:0,width:0,height:0};this.start={x:0,y:0};this.limit=0;this.rayPoints=[]}calPoints(angle,type){angle=Math.abs(angle);let bHeight;let bY;if(angle<90-1){if(type==0){this.rayPoints.length=0;bHeight=this.start.x*Math.tan(df.MathUtil.angle2radian(angle));bY=this.rect.height-bHeight;this.rayPoints.push({x:this.start.x,y:this.start.y});this.rayPoints.push({x:this.rect.width+this.rect.x,y:bY});this.calPoints(angle,-1)}else if(type==-1){bHeight=this.rect.width*Math.tan(df.MathUtil.angle2radian(angle));bY=this.rayPoints[this.rayPoints.length-1].y-bHeight;if(bY<this.limit){return}this.rayPoints.push({x:this.rect.x,y:bY});this.calPoints(angle,1)}else if(type==1){bHeight=this.rect.width*Math.tan(df.MathUtil.angle2radian(angle));bY=this.rayPoints[this.rayPoints.length-1].y-bHeight;if(bY<this.limit){return}this.rayPoints.push({x:this.rect.width+this.rect.x,y:bY});this.calPoints(angle,-1)}}else if(angle>90+1){if(type==0){angle=180-angle;this.rayPoints.length=0;bHeight=(this.start.x-this.rect.x)*Math.tan(df.MathUtil.angle2radian(angle));bY=this.rect.height-bHeight;this.rayPoints.push({x:this.start.x,y:this.start.y});this.rayPoints.push({x:this.rect.x,y:bY});this.calPoints(angle,1)}}}}df.BubbleRay=BubbleRay;__reflect(BubbleRay.prototype,"df.BubbleRay")})(df||(df={}));var df;(function(df){class PSAlgo{constructor(){this.row=10;this.col=10;this.colors=4;this.grids=[];this._hasSelected=[];this._uniteStars=[]}initGrids(){this.grids.length=0;for(let i=0;i<this.row*this.col;i++){let grid=new df.PSGrid;grid.num=df.MathUtil.randomInt(1,this.colors);grid.gridX=i%this.col;grid.gridY=Math.floor(i/this.col);this.grids.push(grid)}if(this.gameOver()){this.initGrids()}else{this.print()}}test(){let data=[[0,0,0,2,0,0,2,0,0,1],[0,3,1,2,0,3,1,0,1,0]];this.row=data.length;this.col=data[0].length;this.grids.length=0;for(let i=0;i<data.length;i++){for(let j=0;j<data[i].length;j++){let grid=new df.PSGrid;grid.num=data[i][j];grid.gridX=j;grid.gridY=i;this.grids.push(grid)}}this.print()}print(){let str="";let line=0;for(let i=0;i<this.grids.length;i++){let grid=this.grids[i];if(line!=grid.gridY){line=grid.gridY;str+="\n"}if(grid.num==0){str+="_ "}else{str+=`${grid.num} `}}console.log(str);console.log("*********************************")}auto(){if(this.gameOver()){console.log("游戏结束!!!")}else{let tip=this.tip();let randomStar=df.ArrayUtil.getRandomItem(tip);let uniteStars=this.getUniteStars(randomStar);this.move(uniteStars);this.print()}}move(stars){let obj=this.getDisCol(stars);let move={down:[],left:[]};for(let i=0;i<obj.gridsX.length;i++){let data=obj.gridsX[i];let gridXStars=this.getGridXstars(data.key);df.ArrayUtil.sortDesBy("gridY",gridXStars);if(gridXStars.length==0){data.clean=true}let allGirdsX=this.getGridsByX(data.key);df.ArrayUtil.sortDesBy("gridY",allGirdsX);for(let j=0;j<this.row;j++){if(gridXStars[j]){let dis=this.row-j-gridXStars[j].gridY-1;if(dis!=0){move.down.push({gridX:gridXStars[j].gridX,girdY:gridXStars[j].gridY,dis:dis})}allGirdsX[j].num=gridXStars[j].num}else{allGirdsX[j].num=0}}}this.formatLeft(obj,move);console.log(move);for(let i=0;i<obj.gridsX.length;i++){let data=obj.gridsX[i];if(data.clean){for(let j=data.key+1;j<this.col;j++){for(let k=0;k<this.row;k++){let leftGrid=this.getGrid(j-1,k);let cur=this.getGrid(j,k);leftGrid.num=cur.num;cur.num=0}}}}return move}getGridXstars(gridX){let stars=[];for(let i=0;i<this.grids.length;i++){if(this.grids[i].gridX==gridX&&this.grids[i].num!=0){stars.push(this.grids[i])}}return stars}getGridsByX(gridX){let grids=[];for(let i=0;i<this.grids.length;i++){if(this.grids[i].gridX==gridX){grids.push(this.grids[i])}}return grids}getGrid(gridX,gridY){for(let i=0;i<this.grids.length;i++){let grid=this.grids[i];if(grid.gridX==gridX&&grid.gridY==gridY){return grid}}return}getDisCol(stars){let obj={gridsX:[]};for(let i=0;i<stars.length;i++){let star=stars[i];star.num=0;let has=false;for(let i=0;i<obj.gridsX.length;i++){if(obj.gridsX[i].key==star.gridX){has=true;break}}if(!has){obj.gridsX.push({key:star.gridX})}}df.ArrayUtil.sortDesBy("key",obj.gridsX);return obj}formatLeft(obj,move){for(let i=0;i<obj.gridsX.length;i++){let data=obj.gridsX[i];if(data.clean){for(let j=data.key+1;j<this.col;j++){let gridXStars=this.getGridXstars(j);for(let k=0;k<gridXStars.length;k++){move.left.push({gridX:gridXStars[k].gridX,gridY:gridXStars[k].gridY})}}}}let left=[];for(let i=0;i<move.left.length;i++){let m=move.left[i];let has=false;for(let j=0;j<left.length;j++){if(left[j].gridX==m.gridX&&left[j].gridY==m.gridY){left[j].dis++;has=true}}if(!has){m.dis=1;left.push(m)}}move.left=left}getUniteStars(star){this._hasSelected.length=0;this._uniteStars.length=0;this.scanUniteStars(star);return this._uniteStars}scanUniteStars(star){if(this._hasSelected.indexOf(star)==-1){this._hasSelected.push(star);if(this._uniteStars.indexOf(star)==-1){this._uniteStars.push(star)}let rounds=this.selectRoundGrid(star);for(let i=0;i<rounds.length;i++){if(rounds[i].num==star.num){this.scanUniteStars(rounds[i])}}}}selectRoundGrid(star){let r=[];for(let i=0;i<this.grids.length;i++){let data=this.grids[i];if(star.gridX==data.gridX&&star.gridY==data.gridY+1){r.push(data)}if(star.gridX==data.gridX&&star.gridY==data.gridY-1){r.push(data)}if(star.gridX==data.gridX+1&&star.gridY==data.gridY){r.push(data)}if(star.gridX==data.gridX-1&&star.gridY==data.gridY){r.push(data)}}return r}tip(){let tipStars;for(let i=0;i<this.grids.length;i++){if(this.grids[i].num!=0){tipStars=this.getUniteStars(this.grids[i]);if(tipStars&&tipStars.length>=2){break}}}return tipStars}gameOver(){let tipStars=this.tip();if(tipStars&&tipStars.length>=2){return false}else{return true}}}df.PSAlgo=PSAlgo;__reflect(PSAlgo.prototype,"df.PSAlgo")})(df||(df={}));var df;(function(df){class PSGrid{constructor(){}}df.PSGrid=PSGrid;__reflect(PSGrid.prototype,"df.PSGrid")})(df||(df={}));var df;(function(df){class ArrayUtil{constructor(){}static random(arr){arr.sort((a,b)=>{return Math.random()>.5?1:-1});return arr}static getRandomItem(arr){return arr[Math.floor(arr.length*Math.random())]}static cull(arr1,arr2){let index=-1;for(let i=0;i<arr2.length;i++){index=arr1.indexOf(arr2[i]);if(index!=-1){arr1.splice(index,1)}}return arr1}static sortAscBy(key,arr){arr.sort((a,b)=>{if(a[key]<b[key]){return-1}else if(a[key]>b[key]){return 1}else{return 0}});return arr}static sortDesBy(key,arr){return this.sortAscBy(key,arr).reverse()}static includes(arr,item){return arr.indexOf(item)!=-1}static maxNum(arr){let r=-1;for(let i=0;i<arr.length;i++){if(r<arr[i]){r=arr[i]}}return r}}df.ArrayUtil=ArrayUtil;__reflect(ArrayUtil.prototype,"df.ArrayUtil")})(df||(df={}));var df;(function(df){class CCDUtil{constructor(){}static rect2rect(rect1,rect2,step=1){return this.a2b(Object.assign({},rect1,{shape:this.RECT,r:0}),Object.assign({},rect2,{shape:this.RECT,r:0}),step)}static a2b(a,b,step){let loop=this.getLoop(a.speed,b.speed,step);let aStepSpeed=this.getStepSpeed(a.speed,loop);let bStepSpeed=this.getStepSpeed(b.speed,loop);let collision;for(let i=0;i<loop;i++){a.x+=aStepSpeed.vx;a.y+=aStepSpeed.vy;b.x+=bStepSpeed.vx;b.y+=bStepSpeed.vy;if(a.shape==b.shape&&b.shape==this.RECT){if(df.CollisionUtil.rect2rect(a,b)){collision=true;break}}else if(a.shape==b.shape&&b.shape==this.CIRCLE){if(df.CollisionUtil.circle2Circle(a,b)){collision=true;break}}else if(a.shape==this.RECT&&b.shape==this.CIRCLE){if(df.CollisionUtil.rect2Circle(a,b)){collision=true;break}}}return collision}static getLoop(speed1,speed2,step){let loop=Math.max(Math.abs(speed1.vx),Math.abs(speed1.vy),Math.abs(speed2.vx),Math.abs(speed2.vy))/step;return Math.ceil(loop)}static getStepSpeed(speed,step){let stepSpeed;stepSpeed.vx=speed.vx/step;stepSpeed.vy=speed.vy/step;return stepSpeed}static rect2Circle(rect,circle,step=1){return this.a2b(Object.assign({},rect,{shape:this.RECT,r:0}),Object.assign({},circle,{shape:this.CIRCLE,width:0,height:0}),step)}static circle2Circle(circle1,circle2,step=1){return this.a2b(Object.assign({},circle1,{shape:this.CIRCLE,width:0,height:0}),Object.assign({},circle2,{shape:this.CIRCLE,width:0,height:0}),step)}}CCDUtil.RECT="rect";CCDUtil.CIRCLE="circle";df.CCDUtil=CCDUtil;__reflect(CCDUtil.prototype,"df.CCDUtil")})(df||(df={}));var df;(function(df){class CollisionUtil{constructor(){}static rect2rect(rect1,rect2){if(rect1.x+rect1.width<rect2.x||rect1.y+rect1.height<rect2.y||rect2.x+rect2.width<rect1.x||rect2.y+rect2.height<rect1.y){return false}else{}return true}static rect2Circle(rect,circle){if(df.MathUtil.dis(rect,circle)<=circle.r||df.MathUtil.dis({x:rect.x+rect.width,y:rect.y},circle)<=circle.r||df.MathUtil.dis({x:rect.x+rect.width,y:rect.y+rect.height},circle)<=circle.r||df.MathUtil.dis({x:rect.x,y:rect.y+rect.height},circle)<=circle.r){return true}else{if(this.rect2rect(rect,{x:circle.x-circle.r,y:circle.y-circle.r,width:2*circle.r,height:2*circle.r})){if(circle.x<rect.x&&circle.y<rect.y||circle.x>rect.x+rect.width&&circle.y<rect.y||circle.x>rect.x+rect.width&&circle.y>rect.y+rect.height||circle.x<rect.x&&circle.y>rect.y+rect.height){return false}return true}else{return false}}}static circle2Circle(c1,c2){return df.MathUtil.dis(c1,c2)<c1.r+c2.r}}df.CollisionUtil=CollisionUtil;__reflect(CollisionUtil.prototype,"df.CollisionUtil")})(df||(df={}));var df;(function(df){class HttpUtil{constructor(){}static sendPostRequest(url,params,success,fail){this.getRequest(url,params,success,fail,egret.HttpMethod.POST)}static sendGetRequest(url,params,success,fail){this.getRequest(url,null,success,fail,egret.HttpMethod.GET)}static sendDeleteRequest(url,params,success,fail){this.getRequest(url,params,success,fail,"DELETE")}static getRequest(url,params,success,fail,type){var request=new egret.HttpRequest;request.responseType=egret.HttpResponseType.TEXT;request.open(url,type);if(params){request.setRequestHeader("Content-Type","application/json;charset=UTF-8")}else if(type!=egret.HttpMethod.GET){request.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}request.send(params);request.addEventListener(egret.Event.COMPLETE,success,this);request.addEventListener(egret.IOErrorEvent.IO_ERROR,fail,this)}static getResponseData(event){var request=event.currentTarget;let res=request.response;if(res==""){return""}else{return JSON.parse(res)}}}df.HttpUtil=HttpUtil;__reflect(HttpUtil.prototype,"df.HttpUtil")})(df||(df={}));var df;(function(df){class ImgUtil{static getArraybufferByUrl(src,callback){var xhr=new XMLHttpRequest;xhr.open("GET",src,true);xhr.responseType="arraybuffer";xhr.onload=function(e){if(xhr.status==200){var uInt8Array=new Uint8Array(xhr.response);callback.call(this,uInt8Array)}};xhr.send()}}df.ImgUtil=ImgUtil;__reflect(ImgUtil.prototype,"df.ImgUtil")})(df||(df={}));var df;(function(df){class MathUtil{constructor(){}static angle2radian(angle){return angle/180*Math.PI}static radian2angle(radian){return radian/Math.PI*180}static pointerAngle(source,target){let radians=Math.atan2(target.y-source.y,target.x-source.x);return df.MathUtil.radian2angle(radians)}static egretToward(source,target){source.rotation=this.pointerAngle(source,target)+90}static cocosToward(source,target){source.angle=this.pointerAngle(source,target)-90}static dis(p1,p2){return Math.sqrt((p1.x-p2.x)*(p1.x-p2.x)+(p1.y-p2.y)*(p1.y-p2.y))}static equalInRange(a,b,range=1e-4){if(Math.abs(Math.abs(a)-Math.abs(b))<range){return true}else{return false}}static randomInt(min,max){return min+Math.round((max-min)*Math.random())}static getLineCircleIntersectP(x1,y1,x2,y2,x3,y3,r){if(x1==x2){let Y=r*r-(x1-x3)*(x1-x3);if(Y<0){return[]}else{return[{x:x1,y:Math.sqrt(Y)+y3},{x:x1,y:-Math.sqrt(Y)+y3}]}}let k=(y1-y2)/(x1-x2);let b=y1-k*x1;let A=k*k+1;let B=2*k*b-2*x3-2*k*y3;let C=x3*x3+y3*y3+b*b-r*r-2*b*y3;let delta=B*B-4*A*C;if(delta<0){return[]}else{let r1x=(-B+Math.sqrt(delta))/(2*A);let r1y=k*r1x+b;let r2x=(-B-Math.sqrt(delta))/(2*A);let r2y=k*r2x+b;return[{x:r1x,y:r1y},{x:r2x,y:r2y}]}}static getLineRectIntersectP(x1,y1,x2,y2,x,y,width,height){let rectLines=[[x,y,x+width,y],[x,y,x,y+height],[x,y+height,x+width,y+height],[x+width,y,x+width,y+height]];let interP=[];for(let i=0;i<rectLines.length;i++){let line=rectLines[i];let p=this.getLineLineIntersectP(x1,y1,x2,y2,line[0],line[1],line[2],line[3]);if(p!=1&&p!=-1){if(this.isPointInRectSo(p.x,p.y,x,y,width,height)){interP.push(p)}}}return interP}static getLineLineIntersectP(x1,y1,x2,y2,x3,y3,x4,y4){let k1,k2,b1,b2;if(x1==x2){if(x3==x4){if(x1==x3){return 1}return-1}else{k2=(y3-y4)/(x3-x4);b2=y3-k2*x3;return{x:x1,y:k2*x1+b2}}}else if(x3==x4){if(x1==x2){if(x3==x1){return 1}return-1}else{k1=(y1-y2)/(x1-x2);b1=y1-k1*x1;return{x:x3,y:k1*x3+b1}}}k1=(y1-y2)/(x1-x2);b1=y1-k1*x1;k2=(y3-y4)/(x3-x4);b2=y3-k2*x3;if(k1==k2){if(b1==b2){return 1}return-1}let interX=(b2-b1)/(k1-k2);let interY=k1*interX+b1;return{x:interX,y:interY}}static isPointInRect(pX,pY,x,y,width,height){return pX>=x&&pX<=x+width&&pY>=y&&pY<=y+height}static isPointInRectSo(pX,pY,x,y,width,height){return(pX>=x||this.equalInRange(pX,x))&&(pX<=x+width||this.equalInRange(pX,x+width))&&(pY>=y||this.equalInRange(pY,y))&&(pY<=y+height||this.equalInRange(pY,y+height))}static toFixedFloor(num,fixed){let numStr=num.toString();let dotIndex=numStr.indexOf(".");if(dotIndex!=-1){for(let i=0;i<fixed;i++){numStr+="0"}numStr=numStr.slice(0,dotIndex+fixed+1)}else{numStr=num.toFixed(fixed)}return numStr}}df.MathUtil=MathUtil;__reflect(MathUtil.prototype,"df.MathUtil")})(df||(df={}));var df;(function(df){class StringUtil{static getStrByByteLen(length,str){var count=0;var index=str.length-1;for(var i=0;i<str.length;i++){if(str.charCodeAt(i)>255){count+=2}else{count++}if(count>=length){index=i;break}}if(index>=str.length-1){return str}return str.substr(str,index+1)+".."||str}static reverse(str){return str.split("").reverse().join("")}static removeEnter(str){return str.replace(/[\n|\r|(\r\n)|(\u0085)|(\u2028)|(\u2029))]/g,"")}static getUrlValueByKey(key=""){if(!key)return"";let url=window.location.href;let str=url.split("?")[1];let val="";if(str){let arr=str.split("&");for(let qst of arr){if(qst.search(key)>=0){if(qst.search("=")>=0){val=qst.split("=")[1]}else{val="default"}break}}}return val}static getBase64(str){var encode=encodeURIComponent(str);var base64=btoa(encode);return base64}}df.StringUtil=StringUtil;__reflect(StringUtil.prototype,"df.StringUtil")})(df||(df={}));var df;(function(df){class TimeUtil{constructor(){}static inTimeRange(start,end){let now=(new Date).getTime();let startTime=new Date(start).getTime();let endTime=new Date(end).getTime();if(startTime<=now&&now<=endTime){return true}else{return false}}static hms(time){let hour=Math.floor(time/3600);let minute=Math.floor(time/60)%60;let second=time%60;let hstr=hour>9?hour:"0"+hour;let mstr=minute>9?minute:"0"+minute;let sstr=second>9?second:"0"+second;return hstr+":"+mstr+":"+sstr}static ms(time){let minute=Math.floor(time/60);let second=time%60;let mstr=minute>9?minute:"0"+minute;let sstr=second>9?second:"0"+second;return mstr+":"+sstr}}df.TimeUtil=TimeUtil;__reflect(TimeUtil.prototype,"df.TimeUtil")})(df||(df={}));var df;(function(df){class ToolUtil{constructor(){}static CLICK(context,callBack,time=1e3,param="_canClick"){if(context[param]==undefined){context[param]=true}if(context[param]){context[param]=false;setTimeout(()=>{context[param]=true},time);callBack()}else{console.log("Cant click now! Wait!")}}}df.ToolUtil=ToolUtil;__reflect(ToolUtil.prototype,"df.ToolUtil")})(df||(df={}));